<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Passbook | Virtual Banking System</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        *{margin:0;padding:0;box-sizing:border-box}

        body{
            font-family:'Poppins',sans-serif;
            background:linear-gradient(135deg,#667eea,#764ba2);
            min-height:100vh;
            padding:20px;
        }

        /* ===== Container ===== */
        .container{
            max-width:1000px;
            margin:auto;
            background:rgba(255,255,255,0.18);
            backdrop-filter:blur(20px);
            border-radius:20px;
            box-shadow:0 30px 80px rgba(0,0,0,.35);
            overflow:hidden;
        }

        /* ===== Header ===== */
        .header{
            background:linear-gradient(135deg,#667eea,#764ba2);
            padding:25px 30px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            color:white;
        }

        .header h1{font-size:30px;letter-spacing:2px}

        .header-actions{
            display:flex;
            gap:12px;
        }

        .btn-header{
            padding:10px 22px;
            border:2px solid white;
            background:rgba(255,255,255,.25);
            color:white;
            border-radius:10px;
            font-weight:600;
            cursor:pointer;
            text-decoration:none;
            transition:.3s;
        }

        .btn-header:hover{
            background:white;
            color:#667eea;
        }

        /* ===== Content ===== */
        .content{
            background:white;
            padding:35px;
            border-radius:25px 25px 0 0;
        }

        /* ===== Top Section ===== */
        .passbook-header{
            display:flex;
            justify-content:space-between;
            align-items:center;
            margin-bottom:30px;
        }

        .passbook-header h2{
            font-size:26px;
        }

        /* ===== Balance Card ===== */
        .balance-card{
            background:linear-gradient(135deg,#667eea,#764ba2);
            color:white;
            padding:22px 30px;
            border-radius:16px;
            box-shadow:0 12px 35px rgba(102,126,234,.55);
        }

        .balance-card p{
            font-size:13px;
            opacity:.9;
        }

        .balance-card .amount{
            font-size:30px;
            font-weight:700;
            margin-top:6px;
        }

        /* ===== Transactions ===== */
        .transactions-section{
            background:#f8f9fa;
            padding:30px;
            border-radius:18px;
        }

        .transactions-list{
            display:flex;
            flex-direction:column;
            gap:14px;
        }

        .transaction-item{
            background:white;
            padding:18px;
            border-radius:14px;
            display:flex;
            justify-content:space-between;
            align-items:center;
            border-left:6px solid #667eea;
            box-shadow:0 6px 18px rgba(0,0,0,.06);
            transition:.3s;
        }

        .transaction-item:hover{
            transform:translateY(-3px);
            box-shadow:0 10px 26px rgba(0,0,0,.12);
        }

        .transaction-item.deposit{border-left-color:#43e97b}
        .transaction-item.withdrawal{border-left-color:#f5576c}
        .transaction-item.transfer{border-left-color:#4facfe}

        .transaction-info{
            display:flex;
            gap:15px;
            align-items:center;
        }

        .transaction-icon{
            width:46px;
            height:46px;
            border-radius:50%;
            display:flex;
            align-items:center;
            justify-content:center;
            font-size:22px;
        }

        .deposit .transaction-icon{background:#d4f8e8;color:#43e97b}
        .withdrawal .transaction-icon{background:#fde0e5;color:#f5576c}
        .transfer .transaction-icon{background:#d4e7ff;color:#4facfe}

        .transaction-details .type{
            font-weight:600;
            color:#333;
        }

        .transaction-details .date{
            font-size:12px;
            color:#999;
        }

        .transaction-right{
            text-align:right;
        }

        .transaction-amount{
            font-size:16px;
            font-weight:700;
        }

        .deposit .transaction-amount{color:#43e97b}
        .withdrawal .transaction-amount{color:#f5576c}
        .transfer .transaction-amount{color:#4facfe}

        .balance-display{
            font-size:12px;
            color:#999;
        }

        /* ===== Pagination ===== */
        .pagination{
            margin-top:25px;
            display:flex;
            justify-content:center;
            gap:10px;
        }

        .pagination button{
            padding:8px 14px;
            border-radius:8px;
            border:1px solid #ddd;
            cursor:pointer;
            font-weight:500;
        }

        .pagination .active{
            background:#667eea;
            color:white;
            border-color:#667eea;
        }

        /* ===== Responsive ===== */
        @media(max-width:700px){
            .passbook-header{
                flex-direction:column;
                gap:15px;
                align-items:flex-start;
            }

            .transaction-item{
                flex-direction:column;
                align-items:flex-start;
                gap:10px;
            }

            .transaction-right{
                align-self:flex-end;
            }
        }
    </style>
</head>

<body>

<div class="container">

    <div class="header">
        <h1>VBS</h1>
        <div class="header-actions">
            <a id="dashLink" class="btn-header">‚Üê Dashboard</a>
            <button class="btn-header" onclick="logout()">Logout</button>
        </div>
    </div>

    <div class="content">

        <div class="passbook-header">
            <h2>Your Passbook</h2>
            <div class="balance-card">
                <p>Current Balance</p>
                <div class="amount">‚Çπ<span id="currentBalance">0.00</span></div>
            </div>
        </div>

        <div class="transactions-section">
            <div id="transactionsList" class="transactions-list"></div>
            <div id="paginationControls" class="pagination"></div>
        </div>

    </div>
</div>

<script>

    const API_URL = 'http://localhost:8081';
    let userId, role;
    let transactions = [];
    let currentPage = 1;
    const itemsPerPage = 10;

    function getUserIdFromURL(){
        const p = new URLSearchParams(window.location.search);
        userId = p.get('id');
        role = p.get('role') || 'customer';
        if(!userId) location.href='login.html';
        document.getElementById('dashLink').href =
            `dashboard.html?id=${userId}&role=${encodeURIComponent(role)}`;
    }

    async function loadPassbook(){
        const r = await fetch(`${API_URL}/passbook/${userId}`);
        transactions = await r.json();
        if(transactions.length)
            document.getElementById('currentBalance').textContent =
                transactions[transactions.length-1].currBalance.toFixed(2);
        render();
    }

    function getType(d){
        d=d.toLowerCase();
        if(d.includes('deposit')) return 'deposit';
        if(d.includes('withdrawal')) return 'withdrawal';
        return 'transfer';
    }

    function render(){
        const list = document.getElementById('transactionsList');
        const pag = document.getElementById('paginationControls');

        const sorted=[...transactions].sort((a,b)=>new Date(b.date)-new Date(a.date));
        const totalPages=Math.ceil(sorted.length/itemsPerPage);
        const slice=sorted.slice((currentPage-1)*itemsPerPage,currentPage*itemsPerPage);

        list.innerHTML=slice.map(t=>{
            const type = getType(t.description);
            let sign='-';
            if(type==='deposit'||(type==='transfer'&&t.description.toLowerCase().includes('received'))) sign='+';
            const icon=type==='deposit'?'üì•':type==='withdrawal'?'üí∏':'üîÅ';

            return `
            <div class="transaction-item ${type}">
                <div class="transaction-info">
                    <div class="transaction-icon">${icon}</div>
                    <div class="transaction-details">
                        <div class="type">${t.description}</div>
                        <div class="date">${new Date(t.date).toLocaleString('en-IN')}</div>
                    </div>
                </div>
                <div class="transaction-right">
                    <div class="transaction-amount">${sign}‚Çπ${t.amount.toFixed(2)}</div>
                    <div class="balance-display">Balance ‚Çπ${t.currBalance.toFixed(2)}</div>
                </div>
            </div>`;
        }).join('');

        pag.innerHTML='';
        for(let i=1;i<=totalPages;i++){
            pag.innerHTML+=`<button class="${i===currentPage?'active':''}" onclick="go(${i})">${i}</button>`;
        }
    }

    function go(p){currentPage=p;render()}
    function logout(){location.href='home.html'}

    window.onload=()=>{
        getUserIdFromURL();
        loadPassbook();
    };
</script>

</body>
</html>
